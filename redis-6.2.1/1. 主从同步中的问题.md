#  主从同步中的问题

## 1. Redis主从同步中，如果中间断了，再次同步时，是怎样保证数据一致性的？

问题是这样的

```
在征程的同步期间，如果 master 给 slave 发送一条 command， 发出去后连接就断开了。那下次重连后是如何初始化同步的，也就是怎么判断上一条是否在 slave 上执行了。
```

redis中的实现

```
首先有这样的疑问，是因为站在了master上去思考问题： 
    
    对于一条 command，master发出去后，是无法知道slave是否执行成功的。
    所以当连接断开后，在次重连时 master 是无法确定该 slave 中正确的 offset 是什么，
    如果在master上做文章（比如添加确认等），就会把问题变的极其复杂，同时也不能保证数据的一致性

redis 中， 断开后，再次重连时，slave 主动要求同步的 offset
    
    因为slave是准确知道自己已经成功执行到哪条了，此时 master 仅仅是被动的接受请求，并在 backlog_buffer 中查找对应的 offset
```